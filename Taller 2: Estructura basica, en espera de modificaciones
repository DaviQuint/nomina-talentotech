#Taller 2 con algunas funciones y varios cambios

#-------------Funcion principal(Esperando cambios):
def funcion_principal():
    while True: #ciclo que pide datos hasta "salir"
        datos_empleados = ingresar_datos() #Se ingresan los datos de entrada (nombre, salario
                                            y dias trabajados) dentro del bucle y se añaden a la lista
        devengado = calcular_salario_devengado( datos_de_empleados["salario"] , datos_de_empleados["dias_trabajados"] )
        neto = calcular_salario_neto()


#-------------Funciones de input:

#Pedir los datos al usuario
def ingresar_datos(i):
    datos_de_empleados[i] = {}
    datos_de_empleados["nombre"] = str(input("Nombre: \t\t", end=" ")
    datos_de_empleados["salario"] = str(input("Salario: \t\t", end=" ")
    datos_de_empleados["dias_trabajados"] = str(input("Dias trabajados: \t", end=" ")

    return datos_de_empleados
# Hay que crear un diccionario que contenga los datos de input(ingresados) y los mande a otra funcion.
# los datos de esta lista ayudaran haciendo todos los calculos del programa, por eso se deben guardar 
# en un diccionario donde se puedan distinguir por empleado 1, 2 3 etc.


#-------------Validaciones

# Aqui iran todas las validaciones, entre ellas: Validacion de datos ingresados, validacion de auxilio de 
# transporte; validacion de todo tipo de datos, entradas y salidas en general


#-------------Funciones de calculo:

#Funcion para calcular el salario devengado
def calcular_salario_devengado(salario_basico, dias_laborados):
    return ((salario_basico/30)*dias_laborados)

#Aparte estan la funcion de descuentos y la de auxilio de transporte que ya estan listas: 
Hay que preguntar que opinan de los cambios mostrados en libreria-nomina.py:

def calcular_aux_transporte(): #Va en validaciones

def descuentos():


def calcular_salario_neto(devengado, descuentos):

def calcular_nomina_total():

def calcular totales():


#-------------Funcion de print:

def mostrar_tabla():

def mostrar_totales():



#### NUEVO #### Validaciones organizar arriba
import os #para limpiar pantalla
import constantes #Para llamar contantes
from tabulate import tabulate #para la presentacion
from colorama import Fore, Style, init 
from typing import Dict, Any, Optional, List

init(autoreset=True)

#Diccionario para almacenar empleados
empleados_registrados={}

#Funcion para limpiar pantalla en este caso devuelve el nombre del sistema operativo y aplica el comando respectivo
def limpiarPantalla ():
    if os.name == 'nt':  # Para sistemas Windows
        os.system('cls')
    else:  # Para sistemas Unix/Linux/Mac
        os.system('clear')


### *** FUNCIONES DE VALIDACIONES *** ###
#Funcion para validar el nombre del empleado
def validar_nombre():
    while True:
        nombre=input("Nombre del empleado (o 'salir' para finalizar) :\n") #pide el nombre del empleado 
        
        if not nombre: #Para que no acepte vacios
            print(Fore.RED + "Error: No puede estar el nombre vacio")
        if nombre.lower() == "salir":
            return None
        
        if all(caracter.isalpha() or caracter.isspace() for caracter in nombre):  # Para Asegurar que solo hallan letras y espacios
            return nombre
        print(Fore.RED + "Error: Ingrese un nombre valido (solo con letras)") #mensaje de error
        


#Funcion para validar el salario basico esta en el intervalo valido que es entre el salario minimo y 8.000.000
def validar_salario_basico():
    while True: 
        try: 
            salario = int(input("Salario Básico Mensual del Empleado: "))
            if constantes.SALARIO_MINIMO <= salario <= 8000000:
                return salario
            print(Fore.RED + f"Error: Ingrese un salario entre {constantes.SALARIO_MINIMO} y 8.000.000 " )
        except ValueError:
            print(Fore.RED + "Error: Ingrese un número válido.")

#Funcion para validar los dias trabajados, que no los dias de un mes
def validar_dias_laborados():
    while True:
        try:
            dias=int(input("Ingrese los dias laborados del mes: "))
            if 0 <= dias <=30:
                return dias
            print(Fore.RED + "Error: Ingrese una cantidad entre 0 y 30")
        except ValueError:
            print(Fore.RED + "Error: Ingrese un número valido. ")




### FUNCIONES ORGANIZAR ARRIBA SEGUN CORRESPONDA
### *** FUNCIONES DE CALCULOS *** #
#Funcion para calcular auxilio de transporte
def calcular_auxilio_transporte(salario_basico):
    if salario_basico < (2*constantes.SALARIO_MINIMO):
        return 200000 #valor auxilio transporte actual
    else:
        return 0

#Funcion para calcular el salario devengado
def calcular_salario_devengado(salario_basico, dias_laborados):
    return round((salario_basico/30)*dias_laborados)
    
    
#Funcion para calcular descuentos
def calcular_descuentos(salario_devengado):
    descuento_salud= salario_devengado*constantes.SALUD
    descuento_pension=salario_devengado*constantes.PENSION
    return descuento_salud, descuento_pension


#Funcion para calcular salario neto
def calcular_salario_neto(salario_devengado, AUX_TRANSPORTE, descuento_salud, descuento_pension):
    return round(salario_devengado + AUX_TRANSPORTE - (descuento_salud + descuento_pension))


### *** FUNCION PARA INGRESAR LOS DATOS ###
def ingresar_datos():
    empleado_ID=len(empleados_registrados)+1
    nombre=validar_nombre()
    if nombre is None:
        return None #Salir del ingreso de datos

    salario_basico = validar_salario_basico()
    dias_laborados= validar_dias_laborados()
    salario_devengado= calcular_salario_devengado(salario_basico, dias_laborados)
    aux_transporte=calcular_auxilio_transporte(salario_basico)
    descuento_salud, descuento_pension = calcular_descuentos(salario_devengado)
    salario_neto=calcular_salario_neto(salario_devengado, aux_transporte, descuento_salud, descuento_pension)

    empleado={
        "Nombre": nombre,
        "Salario Devengado": salario_devengado,
        "Auxilio de Transporte": aux_transporte,
        "Descuento Salud": descuento_salud,
        "Descuento Pensión": descuento_pension,
        "Salario Neto Recibido": salario_neto
    }
    
    empleados_registrados[empleado_ID]=empleado
    
    return empleado

# Funcion para mostrar en pantalla
def mostrar_en_consola():
    limpiarPantalla()
    
    if not empleados_registrados:
        print(Fore.YELLOW + "No hay empleados registrados")
        return
    
    tabla_datos_empleados=[]
    total_aux_transporte = 0
    total_salud = 0
    total_pension = 0
    total_nomina = 0
    
    for emp_ID, datos in empleados_registrados.items():
        tabla_datos_empleados.append([
            emp_ID, datos["Nombre"], datos["Salario Devengado"], datos["Auxilio de Transporte"], 
            datos["Descuento Salud"], datos["Descuento Pensión"], datos["Salario Neto Recibido"]
        ])
        
        # Acumulando correctamente los valores de cada empleado
        total_aux_transporte += datos["Auxilio de Transporte"]
        total_salud += datos["Descuento Salud"]
        total_pension += datos["Descuento Pensión"]
        total_nomina += datos["Salario Devengado"]

    print(tabulate(tabla_datos_empleados, headers=[
        Fore.CYAN + "ID", "Nombre", "Salario Devengado", "Auxilio de Transporte", 
        "Descuento Salud", "Descuento Pensión", "Salario Neto Recibido"
    ], tablefmt="grid"))
    
    # Mostrar totales correctamente
    print(Fore.RED + f"Total Subsidio de Transporte:\t {total_aux_transporte}")
    print(Fore.RED + f"Total Costos de Salud:\t {total_salud}")
    print(Fore.RED + f"Total Costos de Pensión:\t {total_pension}")
    print(Fore.RED + f"Total Nómina Pagada:\t {total_nomina}")
    



        
